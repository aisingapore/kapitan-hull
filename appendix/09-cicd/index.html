<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content end-to-end template for ai projects&quot;&quot;><meta name=author content="AI Singapore"><link href=../../runai/08c-batch-inferencing/ rel=prev><link href=../10-documentation/ rel=next><link rel=icon href=../../favicon.svg><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.5"><title>CI/CD - AI Project Template</title><link rel=stylesheet href=../../assets/stylesheets/main.8608ea7d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../termynal.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=aisg data-md-color-primary=red data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#continuous-integration-deployment class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="AI Project Template" class="md-header__button md-logo" aria-label="AI Project Template" data-md-component=logo> <img src=../../aisg-logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AI Project Template </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> CI/CD </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=aisg data-md-color-primary=red data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Overview </a> </li> <li class=md-tabs__item> <a href=../../setting-up/01-prerequisites/ class=md-tabs__link> Settting Up </a> </li> <li class=md-tabs__item> <a href=../../local/03a-dev-wksp/ class=md-tabs__link> Running Locally </a> </li> <li class=md-tabs__item> <a href=../../docker/03b-dev-wksp/ class=md-tabs__link> Using Docker </a> </li> <li class=md-tabs__item> <a href=../../runai/03c-dev-wksp/ class=md-tabs__link> Using Run:ai </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Sorting Out the Rest </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="AI Project Template" class="md-nav__button md-logo" aria-label="AI Project Template" data-md-component=logo> <img src=../../aisg-logo.png alt=logo> </a> AI Project Template </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Settting Up </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Settting Up </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../setting-up/01-prerequisites/ class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> </li> <li class=md-nav__item> <a href=../../setting-up/02-preface/ class=md-nav__link> <span class=md-ellipsis> Preface </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Running Locally </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Running Locally </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../local/03a-dev-wksp/ class=md-nav__link> <span class=md-ellipsis> Developer Workspace </span> </a> </li> <li class=md-nav__item> <a href=../../local/04a-virtual-env/ class=md-nav__link> <span class=md-ellipsis> Virtual Environments </span> </a> </li> <li class=md-nav__item> <a href=../../local/05a-data-storage-versioning/ class=md-nav__link> <span class=md-ellipsis> Data Storage & Versioning </span> </a> </li> <li class=md-nav__item> <a href=../../local/06a-job-orchestration/ class=md-nav__link> <span class=md-ellipsis> Job Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../../local/07a-deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment </span> </a> </li> <li class=md-nav__item> <a href=../../local/08a-batch-inferencing/ class=md-nav__link> <span class=md-ellipsis> Batch Inferencing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Using Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Using Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docker/03b-dev-wksp/ class=md-nav__link> <span class=md-ellipsis> Developer Workspace </span> </a> </li> <li class=md-nav__item> <a href=../../docker/04b-virtual-env/ class=md-nav__link> <span class=md-ellipsis> Virtual Environments </span> </a> </li> <li class=md-nav__item> <a href=../../docker/05b-data-storage-versioning/ class=md-nav__link> <span class=md-ellipsis> Data Storage & Versioning </span> </a> </li> <li class=md-nav__item> <a href=../../docker/06b-job-orchestration/ class=md-nav__link> <span class=md-ellipsis> Job Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../../docker/07b-deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment </span> </a> </li> <li class=md-nav__item> <a href=../../docker/08b-batch-inferencing/ class=md-nav__link> <span class=md-ellipsis> Batch Inferencing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Using Run:ai </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Using Run:ai </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../runai/03c-dev-wksp/ class=md-nav__link> <span class=md-ellipsis> Developer Workspace </span> </a> </li> <li class=md-nav__item> <a href=../../runai/04c-virtual-env/ class=md-nav__link> <span class=md-ellipsis> Virtual Environments </span> </a> </li> <li class=md-nav__item> <a href=../../runai/05c-data-storage-versioning/ class=md-nav__link> <span class=md-ellipsis> Data Storage & Versioning </span> </a> </li> <li class=md-nav__item> <a href=../../runai/06c-job-orchestration/ class=md-nav__link> <span class=md-ellipsis> Job Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../../runai/07c-deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment </span> </a> </li> <li class=md-nav__item> <a href=../../runai/08c-batch-inferencing/ class=md-nav__link> <span class=md-ellipsis> Batch Inferencing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Sorting Out the Rest </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Sorting Out the Rest </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> CI/CD </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> CI/CD </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#github-flow class=md-nav__link> <span class=md-ellipsis> GitHub Flow </span> </a> </li> <li class=md-nav__item> <a href=#environment-variables class=md-nav__link> <span class=md-ellipsis> Environment Variables </span> </a> <nav class=md-nav aria-label="Environment Variables"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#docker-configuration-file-for-accessing-harbor class=md-nav__link> <span class=md-ellipsis> Docker Configuration File for Accessing Harbor </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#stages-jobs class=md-nav__link> <span class=md-ellipsis> Stages &amp; Jobs </span> </a> </li> <li class=md-nav__item> <a href=#variables class=md-nav__link> <span class=md-ellipsis> Variables </span> </a> </li> <li class=md-nav__item> <a href=#building-the-conda-environment class=md-nav__link> <span class=md-ellipsis> Building the Conda Environment </span> </a> </li> <li class=md-nav__item> <a href=#automated-testing-linting class=md-nav__link> <span class=md-ellipsis> Automated Testing &amp; Linting </span> </a> </li> <li class=md-nav__item> <a href=#automated-builds class=md-nav__link> <span class=md-ellipsis> Automated Builds </span> </a> </li> <li class=md-nav__item> <a href=#tagging class=md-nav__link> <span class=md-ellipsis> Tagging </span> </a> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../10-documentation/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#github-flow class=md-nav__link> <span class=md-ellipsis> GitHub Flow </span> </a> </li> <li class=md-nav__item> <a href=#environment-variables class=md-nav__link> <span class=md-ellipsis> Environment Variables </span> </a> <nav class=md-nav aria-label="Environment Variables"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#docker-configuration-file-for-accessing-harbor class=md-nav__link> <span class=md-ellipsis> Docker Configuration File for Accessing Harbor </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#stages-jobs class=md-nav__link> <span class=md-ellipsis> Stages &amp; Jobs </span> </a> </li> <li class=md-nav__item> <a href=#variables class=md-nav__link> <span class=md-ellipsis> Variables </span> </a> </li> <li class=md-nav__item> <a href=#building-the-conda-environment class=md-nav__link> <span class=md-ellipsis> Building the Conda Environment </span> </a> </li> <li class=md-nav__item> <a href=#automated-testing-linting class=md-nav__link> <span class=md-ellipsis> Automated Testing &amp; Linting </span> </a> </li> <li class=md-nav__item> <a href=#automated-builds class=md-nav__link> <span class=md-ellipsis> Automated Builds </span> </a> </li> <li class=md-nav__item> <a href=#tagging class=md-nav__link> <span class=md-ellipsis> Tagging </span> </a> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=continuous-integration-deployment>Continuous Integration &amp; Deployment<a class=headerlink href=#continuous-integration-deployment title="Permanent link">&para;</a></h1> <p>This template presents users with a base configuration for a GitLab CI/CD pipeline. In this section, the guide aims to provide readers with some basic understanding of the pipeline defined in the configuration file <code>.gitlab-ci.yml</code>.</p> <p>That being said, readers would certainly benefit from reading up on <a href=https://docs.gitlab.com/ee/ci/introduction/ >introductory CI/CD concepts</a> as introduced by GitLab's Docs.</p> <div class=video-wrapper> <iframe width=1280 height=720 src="https://www.youtube.com/embed/l5705U8s_nQ?start=392" title="YouTube video player" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> </div> <h2 id=github-flow>GitHub Flow<a class=headerlink href=#github-flow title="Permanent link">&para;</a></h2> <p>The defined pipeline assumes a GitHub flow which only relies on feature branches and a <code>main</code> (default) branch.</p> <p><img alt="AISG's GitHub Flow Diagram" src=../assets/images/github-flow-aisg-diagram.png></p> <p>With reference to the diagram above, we have the following pointers:</p> <ul> <li>We make use of feature branches (<code>git checkout -b &lt;NAME_OF_BRANCH&gt;</code>) to introduce changes to the source.</li> <li>Merge requests are made when we intend to merge the commits made to a feature branch to <code>main</code>.</li> <li>While one works on a feature branch, it is recommended that changes pushed to the <code>main</code> are pulled to the feature branch itself on a consistent basis. This allows the feature branch to possess the latest changes pushed by other developers through their own feature branches. In the example above, commits from the <code>main</code> branch following a merge of the <code>add-hidden-layer</code> branch are pulled into the <code>change-training-image</code> branch while that branch still expects further changes.</li> <li>The command <code>git pull</code> can be used to pull and sync these changes. However, it's recommended that developers make use of <code>git fetch</code> and <code>git log</code> to observe incoming changes first rather than pulling in changes in an indiscriminate manner.</li> <li>While it's possible for commits to be made directly to the <code>main</code> branch, it's recommended that they are kept minimal, at least for GitHub flow <em>(other workflows might not heed such practices)</em>.</li> </ul> <p>As we move along, we should be able to relate parts of the flow described above with the stages defined by the default GitLab CI pipeline.</p> <p>For more information on Gitlab CI pipeline, you can refer <a href=https://lighthouse.aisingapore.net/tools-and-tech/Gitlab-CICD>here</a> (AISG personnel only).</p> <h2 id=environment-variables>Environment Variables<a class=headerlink href=#environment-variables title="Permanent link">&para;</a></h2> <p>Before we can make use of the GitLab CI pipeline, we would have to define the following variable(s) for the pipeline beforehand, depending on your project's requirements:</p> <ul> <li> <p><code>HARBOR_ROBOT_CREDS_JSON</code>: A JSON formatted value that contains encoded credentials for a robot account on Harbor. This is to allow the pipeline to interact with the Harbor server. See the next section on how to generate this value/file. </p> </li> <li> <p><code>GCP_SERVICE_ACCOUNT_KEY</code>: A JSON formatted value that contains encoded credentials for a service account on your GCP project. This is to allow the pipeline to interact with the Google Artifact Registry. See <a href=https://cloud.google.com/iam/docs/keys-create-delete>here</a> on how to generate this file. </p> </li> </ul> <p>For both variables, after you've generated the JSON file, please encode the file content using <code>base64 -i &lt;file&gt;</code>. Afterwhich, copy paste the encoded value and define it as a CI/CD variable. </p> <p>To define CI/CD variables for a project (repository), follow the steps listed <a href=https://docs.gitlab.com/ee/ci/variables/#define-a-cicd-variable-in-the-ui>here</a>. </p> <p>Both environment variables <code>HARBOR_ROBOT_CREDS_JSON</code> and <code>GCP_SERVICE_ACCOUNT_KEY</code> need to be <code>variable</code> types.</p> <p>After defining the CI/CD variables for the project, your pipeline should be able to pass. If not, re-run the pipeline.</p> <h3 id=docker-configuration-file-for-accessing-harbor>Docker Configuration File for Accessing Harbor<a class=headerlink href=#docker-configuration-file-for-accessing-harbor title="Permanent link">&para;</a></h3> <p>The variable <code>HARBOR_ROBOT_CREDS_JSON</code> will be used to populate the files <code>/kaniko/.docker/config.json</code> and <code>/root/.docker/config.json</code> for <code>kaniko</code> and <code>crane</code> to authenticate themselves before communicating with AI Singapore's Harbor registry. You may create the JSON file like so:</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Linux/macOS</label><label for=__tabbed_1_2>Windows PowerShell</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span>&lt;HARBOR_USERNAME&gt;:&lt;HARBOR_PASSWORD&gt;<span class=w> </span><span class=p>|</span><span class=w> </span>base64
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nv>$Env:cred</span> <span class=p>=</span> <span class=s2>&quot;&lt;HARBOR_USERNAME&gt;:&lt;HARBOR_PASSWORD&gt;&quot;</span>
<span class=nv>$Env:bytes</span> <span class=p>=</span> <span class=no>[System.Text.Encoding]</span><span class=p>::</span><span class=n>ASCII</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=nv>$cred</span><span class=p>)</span>
<span class=nv>$Env:base64</span> <span class=p>=</span> <span class=no>[Convert]</span><span class=p>::</span><span class=n>ToBase64String</span><span class=p>(</span><span class=nv>$bytes</span><span class=p>)</span>
<span class=nb>echo </span><span class=nv>$base64</span>
</code></pre></div> </div> </div> </div> <p>Using the output from above, copy and paste the following content into a CI/CD environment variable of type <code>File</code> (under <code>Settings</code> -&gt; <code>CI/CD</code> -&gt; <code>Variables</code> -&gt; <code>Add variable</code>):</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;auths&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;registry.aisingapore.net&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;auth&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&lt;ENCODED_OUTPUT_HERE&gt;&quot;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p><img alt="GitLab UI - Set File Variable under CI/CD Settings" src=../assets/screenshots/gitlab-settings-cicd-set-file-var.png></p> <p>After defining the CI/CD Variables for the project, your pipeline should be able to pass. If not, re-run the pipeline. </p> <details class=info> <summary>Reference Link(s)</summary> <ul> <li><a href=https://docs.gitlab.com/ee/ci/variables/ >GitLab Docs - GitLab CI/CD variables</a></li> <li><a href=https://docs.docker.com/engine/reference/commandline/cli/#configuration-files>Docker Docs - Configuration files</a></li> </ul> </details> <h2 id=stages-jobs>Stages &amp; Jobs<a class=headerlink href=#stages-jobs title="Permanent link">&para;</a></h2> <p>In the default pipeline, we have 3 stages defined:</p> <ul> <li><code>test</code>: For every push to certain branches, the source code residing in <code>src</code> will be tested.</li> <li><code>deploy-docs</code>: This stage is for the purpose of deploying a static site through <a href=https://docs.gitlab.com/ee/user/project/pages>GitLab Pages</a>. More on this stage is covered in <a href=../10-documentation/ >"Documentation"</a>.</li> <li><code>build</code>: Assuming the automated tests are passed, the pipeline will build Docker images, making use of the latest source.</li> </ul> <p>These stages are defined and listed like so:</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:1><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1><code>.gitlab-ci.yml</code></label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nn>...</span>
<span class=nt>stages</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deploy-docs</span>
<span class=nn>...</span>
</code></pre></div> </div> </div> </div> <p>The jobs for each of the stages are executed using Docker images defined by users. For this, we have to specify in the pipeline the tag associated with the GitLab Runner that has the <a href=https://docs.gitlab.com/runner/executors/docker.html>Docker executor</a>. The <code>on-prem</code> tag calls for runners within our on-premise infrastructure so on-premise services can be accessed within our pipelines. The <code>gcp</code> tag calls for runners on our GCP infrastructure so it can use the GCP services within our pipelines.</p> <p>The <code>./conda</code> folder generated from creating the Conda environment is then cached and to be used for other jobs, saving time from rebuilding the environment in every job that requires it. The <code>$CI_COMMIT_REF_SLUG</code> key refers to the branch name modified to be code-friendly. In this case, it is used as a namespace to store all the files that is cached within this branch.</p> <div class="tabbed-set tabbed-alternate" data-tabs=3:1><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1><code>.gitlab-ci.yml</code></label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>default</span><span class=p>:</span>
<span class=w>  </span><span class=nt>tags</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">on-prem</span><span class=w> </span><span class=c1># or `gcp`</span>
<span class=nn>...</span>
</code></pre></div> </div> </div> </div> <h2 id=variables>Variables<a class=headerlink href=#variables title="Permanent link">&para;</a></h2> <p>The GitLab CI pipeline uses several variables to control its behavior:</p> <ul> <li><code>PYTHON_IMAGE</code>: Specifies the Docker image used for Python-based jobs (default: <code>continuumio/miniconda3:24.7.1-0</code>)</li> <li><code>VENV_DIRECTORY</code>: Defines the path where the Conda environment will be created and stored</li> <li><code>IMAGE_TAG</code>: Default tag for Docker images (default: <code>latest</code>)</li> <li><code>BUILD_CONDA</code>: When set in a manual pipeline run, forces the Conda environment to be built</li> <li><code>BUILD_ALL</code>: When set in a manual pipeline run, triggers building of all Docker images</li> <li><code>BUILD_DATAPREP</code>: When set in a manual pipeline run, triggers building of the data preparation image</li> <li><code>BUILD_MODEL</code>: When set in a manual pipeline run, triggers building of the model training image</li> </ul> <p>GitLab also provides many predefined variables that are used in the pipeline: - <code>CI_COMMIT_REF_SLUG</code>: Branch or tag name in a URL-friendly format - <code>CI_COMMIT_SHORT_SHA</code>: The first 8 characters of the commit SHA - <code>CI_DEFAULT_BRANCH</code>: The default branch for the project (usually <code>main</code>) - <code>CI_PIPELINE_SOURCE</code>: How the pipeline was triggered (e.g., "push", "web", "merge_request_event") - <code>CI_PROJECT_DIR</code>: The full path where the repository is cloned - <code>CI_MERGE_REQUEST_IID</code>: The merge request ID if the pipeline is for a merge request - <code>CI_COMMIT_TAG</code>: The commit tag name if the pipeline was triggered by a tag</p> <h2 id=building-the-conda-environment>Building the Conda Environment<a class=headerlink href=#building-the-conda-environment title="Permanent link">&para;</a></h2> <p>Let's look at the job defined for the <code>build</code> stage first:</p> <div class="tabbed-set tabbed-alternate" data-tabs=4:1><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=__tabbed_4_1><code>.gitlab-ci.yml</code></label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nn>...</span>
<span class=nt>build:conda-env</span><span class=p>:</span>
<span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${PYTHON_IMAGE}</span>
<span class=w>  </span><span class=nt>script</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">conda env create -f project-conda-env.yaml -p ${VENV_DIRECTORY}</span>
<span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_MERGE_REQUEST_IID</span>
<span class=w>      </span><span class=nt>changes</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">project-conda-env.yaml</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_PIPELINE_SOURCE == &quot;push&quot;</span>
<span class=w>      </span><span class=nt>changes</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">project-conda-env.yaml</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_PIPELINE_SOURCE == &quot;web&quot;</span>
<span class=w>      </span><span class=nt>changes</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">project-conda-env.yaml</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_PIPELINE_SOURCE == &quot;web&quot; &amp;&amp; $BUILD_CONDA</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_COMMIT_TAG</span>
<span class=w>      </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">never</span>
<span class=w>  </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[]</span>
<span class=nn>...</span>
</code></pre></div> </div> </div> </div> <p>First of all, this <code>build:conda-env</code> job will only execute on the condition that the defined <a href=https://docs.gitlab.com/ee/ci/yaml/#rules><code>rules</code></a> are met. In this case, the job will only execute for the following cases:</p> <ul> <li>For pushes to branches which merge requests have been created, tests are executed only if changes made to the <code>project-conda-env.yaml</code> are detected. This is to prevent automated tests from running for pushes made to feature branches with merge requests when no changes have been made to files for which tests are relevant. Otherwise, tests will run in a redundant manner, slowing down the feedback loop.</li> <li>For any pushes to any branch.</li> <li>For any manual pipeline execution through GitLab's web UI.</li> <li>If the push action is associated with a tag (<code>git push &lt;remote&gt; &lt;tag_name&gt;</code>), the job will not run.</li> </ul> <p>The job does not have any jobs that it needs to wait for, thus the <code>needs</code> section is populated with <code>[]</code>.</p> <h2 id=automated-testing-linting>Automated Testing &amp; Linting<a class=headerlink href=#automated-testing-linting title="Permanent link">&para;</a></h2> <p>The <code>test</code> stage includes two separate jobs: one for linting and one for running tests:</p> <div class="tabbed-set tabbed-alternate" data-tabs=5:2><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><input id=__tabbed_5_2 name=__tabbed_5 type=radio><div class=tabbed-labels><label for=__tabbed_5_1><code>.gitlab-ci.yml</code> - Linting Job</label><label for=__tabbed_5_2><code>.gitlab-ci.yml</code> - Testing Job</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nn>...</span>
<span class=nt>test:lint</span><span class=p>:</span>
<span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class=w>  </span><span class=nt>before_script</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">source activate ${VENV_DIRECTORY}</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pip install -r dev-requirements.txt</span>
<span class=w>  </span><span class=nt>script</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pylint src --fail-under=7.0 --ignore=tests --disable=W1202</span>
<span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_MERGE_REQUEST_IID</span>
<span class=w>      </span><span class=nt>changes</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">src/**/*</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">conf/**/*</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_PIPELINE_SOURCE == &quot;push&quot;</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_PIPELINE_SOURCE == &quot;web&quot;</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_COMMIT_TAG</span>
<span class=w>      </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">never</span>
<span class=w>  </span><span class=nt>needs</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build:conda-env</span>
<span class=w>      </span><span class=nt>optional</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nn>...</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nn>...</span>
<span class=nt>test:pytest</span><span class=p>:</span>
<span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class=w>  </span><span class=nt>before_script</span><span class=p>:</span><span class=w> </span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">source activate ${VENV_DIRECTORY}</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pip install -r dev-requirements.txt</span>
<span class=w>  </span><span class=nt>script</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pytest src/tests --junitxml=./rspec.xml</span>
<span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_MERGE_REQUEST_IID</span>
<span class=w>      </span><span class=nt>changes</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">src/**/*</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">conf/**/*</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_PIPELINE_SOURCE == &quot;push&quot;</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_PIPELINE_SOURCE == &quot;web&quot;</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_COMMIT_TAG</span>
<span class=w>      </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">never</span>
<span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span>
<span class=w>    </span><span class=nt>paths</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rspec.xml</span>
<span class=w>    </span><span class=nt>reports</span><span class=p>:</span>
<span class=w>      </span><span class=nt>junit</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rspec.xml</span>
<span class=w>  </span><span class=nt>needs</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build:conda-env</span>
<span class=w>      </span><span class=nt>optional</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nn>...</span>
</code></pre></div> </div> </div> </div> <p>For both the <code>test:lint</code> and <code>test:pytest</code> jobs, they will only execute for the following cases:</p> <ul> <li>For pushes to branches which merge requests have been created, tests are executed only if changes made to any files within <code>src</code> or <code>conf</code> are detected.</li> <li>For any pushes to any branch.</li> <li>For any manual pipeline execution through GitLab's web UI.</li> <li>If the push action is associated with a tag (<code>git push &lt;remote&gt; &lt;tag_name&gt;</code>), the job will not run.</li> </ul> <p>Both jobs wait for <code>build:conda-env</code> to be completed first before they can be executed. The <code>optional: true</code> option is set so that they would still run if the <code>build:conda-env</code> job doesn't since the environment has already been cached to be used in these jobs.</p> <p>The <code>test:lint</code> job fails if the source code does not meet a linting score of at least 7.0.</p> <p>The <code>test:pytest</code> job fails if the source code fails any tests that have been defined under <code>src/tests</code>. This job generates a <code>rspec.xml</code> file as an artifact so that you can read the test results in the GitLab UI. More information about this can be found <a href=https://docs.gitlab.com/ee/ci/testing/unit_test_reports.html>here</a>.</p> <p>Both jobs would have to succeed before moving on to the <code>deploy</code> stage. Otherwise, no Docker images will be built. This is so that source code that fails either linting or tests would never be packaged.</p> <details class=info> <summary>Reference Link(s)</summary> <ul> <li><a href=https://docs.gitlab.com/ee/ci/variables/predefined_variables.html>GitLab Docs - Predefined variables reference</a></li> <li><a href=https://realpython.com/pytest-python-testing/ >Real Python - Effective Python Testing With Pytest</a></li> <li><a href=https://code.visualstudio.com/docs/python/linting>VSCode Docs - Linting Python in Visual Studio Code</a></li> </ul> </details> <h2 id=automated-builds>Automated Builds<a class=headerlink href=#automated-builds title="Permanent link">&para;</a></h2> <p>The template has thus far introduced a couple of Docker images relevant for the team. The tags for all the Docker images are listed below:</p> <ul> <li><code>registry.aisingapore.net/project-path/cpu</code></li> <li><code>registry.aisingapore.net/project-path/gpu</code></li> </ul> <p>The <code>deploy</code> stage aims at automating the building of these Docker images in a parallel manner. Let's look at a snippet for a single job that builds a Docker image:</p> <div class="tabbed-set tabbed-alternate" data-tabs=6:1><input checked=checked id=__tabbed_6_1 name=__tabbed_6 type=radio><div class=tabbed-labels><label for=__tabbed_6_1><code>.gitlab-ci.yml</code></label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nn>...</span>
<span class=nt>build:cpu-image</span><span class=p>:</span>
<span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gcr.io/kaniko-project/executor:debug</span>
<span class=w>    </span><span class=nt>entrypoint</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>variables</span><span class=p>:</span>
<span class=w>      </span><span class=nt>GOOGLE_APPLICATION_CREDENTIALS</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/kaniko/.docker/config.json</span><span class=w> </span><span class=c1># For GCP</span>
<span class=w>  </span><span class=nt>before_script</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;[[</span><span class=nv> </span><span class=s>-z</span><span class=nv> </span><span class=s>${HARBOR_ROBOT_CREDS_JSON}</span><span class=nv> </span><span class=s>]]</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>echo</span><span class=nv> </span><span class=s>&#39;HARBOR_ROBOT_CREDS_JSON</span><span class=nv> </span><span class=s>variable</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>not</span><span class=nv> </span><span class=s>set.&#39;</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>exit</span><span class=nv> </span><span class=s>1&quot;</span><span class=w> </span><span class=c1># For onprem</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;[[</span><span class=nv> </span><span class=s>-z</span><span class=nv> </span><span class=s>${GCP_SERVICE_ACCOUNT_KEY}</span><span class=nv> </span><span class=s>]]</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>echo</span><span class=nv> </span><span class=s>&#39;GCP_SERVICE_ACCOUNT_KEY</span><span class=nv> </span><span class=s>variable</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>not</span><span class=nv> </span><span class=s>set.&#39;</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>exit</span><span class=nv> </span><span class=s>1&quot;</span><span class=w> </span><span class=c1># For GCP</span>
<span class=w>  </span><span class=nt>script</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mkdir -p /kaniko/.docker</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cat $HARBOR_ROBOT_CREDS_JSON &gt; /kaniko/.docker/config.json</span><span class=w> </span><span class=c1># For onprem</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cat $GCP_SERVICE_ACCOUNT_KEY &gt; /kaniko/.docker/config.json</span><span class=w> </span><span class=c1># For GCP</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="p p-Indicator">&gt;-</span>
<span class=w>      </span><span class=no>/kaniko/executor</span>
<span class=w>      </span><span class=no>--context &quot;${CI_PROJECT_DIR}&quot;</span>
<span class=w>      </span><span class=no>--dockerfile &quot;${CI_PROJECT_DIR}/docker/project-cpu.Dockerfile&quot;</span>
<span class=w>      </span><span class=no>--destination &quot;registry.aisingapore.net/project-path/cpu:${CI_COMMIT_SHORT_SHA}&quot;</span>
<span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_MERGE_REQUEST_IID</span>
<span class=w>      </span><span class=nt>changes</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker/project-cpu.Dockerfile</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">src/**/*</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">conf/**/*</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_PIPELINE_SOURCE == &quot;web&quot; &amp;&amp; $BUILD_ALL</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_PIPELINE_SOURCE == &quot;web&quot; &amp;&amp; $BUILD_DATAPREP</span>
<span class=w>  </span><span class=nt>needs</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test:lint</span>
<span class=w>      </span><span class=nt>optional</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test:pytest</span>
<span class=w>      </span><span class=nt>optional</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nn>...</span>
</code></pre></div> </div> </div> </div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>You would have noticed that the jobs for building images utilise the command <code>/kaniko/executor</code> as opposed to <code>docker build</code> which most users would be more familiar with. This is due to the usage of <a href=https://github.com/GoogleContainerTools/kaniko><code>kaniko</code></a> within a runner with a Docker executor. Using Docker within Docker (<a href=https://docs.gitlab.com/ee/ci/docker/using_docker_build.html#use-docker-in-docker>Docker-in-Docker</a>) requires privileged mode that poses several security concerns. Hence, the image <code>gcr.io/kaniko-project/executor:debug</code> is being used for all <code>deploy</code> jobs related to building of Docker images. That being said, the flags used for <code>kaniko</code> corresponds well with the flags usually used for <code>docker</code> commands.</p> </div> <p>Before it goes through the job, it will check whether either <code>HARBOR_ROBOT_CREDS_JSON</code> and <code>GCP_SERVICE_ACCOUNT_KEY</code> have been set in the CI/CD variables. Otherwise, it will prematurely stop the job with the error, preventing the job from running any further and freeing the CI worker faster to work on other jobs in the organisation.</p> <p>Just like with the <code>test</code> jobs, the each of the jobs under <code>deploy</code> will execute under certain conditions:</p> <ul> <li>If a push is being done to a branch which has a merge request opened, a check would be done to see if any changes were made to folders like <code>src</code>, <code>conf</code>, <code>scripts</code>, or the relevant Dockerfile itself. If there are changes, the job will be executed. An opened merge request is detected through the predefined variable <code>CI_MERGE_REQUEST_IID</code>.</li> <li>If a push is being made to the default branch (<code>CI_DEFAULT_BRANCH</code>) of the repo, which in most cases within our organisation would be <code>main</code>, the job would execute as well. Recalling the <code>test</code> stage, any pushes to the repo would trigger the automated tests and linting. If a push to the <code>main</code> branch passes the tests, all Docker images will be built, regardless of whether changes have been made to files relevant to the Docker images to be built themselves.</li> <li>For any manual pipeline execution through GitLab's web UI that has either <code>BUILD_ALL</code> or <code>BUILD_DATAPREP</code> (or <code>BUILD_MODEL</code> for the model training image) variable has been set. It can be set to any value, but we can set it to <code>true</code> by default.</li> </ul> <p>The jobs in the <code>deploy</code> stage requires the <code>test:lint</code> and <code>test:pytest</code> jobs to be successful, otherwise it would not run.</p> <p>Images built through the pipeline will be tagged with the commit hashes associated with the commits that triggered it. This is seen through the usage of the predefined variable <code>CI_COMMIT_SHORT_SHA</code>.</p> <details class=info> <summary>Reference Link(s)</summary> <ul> <li><a href=https://docs.gitlab.com/ee/ci/docker/using_kaniko.html>GitLab Docs - Use kaniko to build Docker images</a></li> <li><a href=https://docs.gitlab.com/ee/ci/docker/using_docker_build.html#use-docker-in-docker>GitLab Docs - Use Docker to build Docker images</a></li> </ul> </details> <h2 id=tagging>Tagging<a class=headerlink href=#tagging title="Permanent link">&para;</a></h2> <p>As mentioned, pushes to the default branch would trigger builds for Docker images and they would be tagged with the commit hash. However, such commit hashes aren't the best way to tag "finalised" Docker images so the usage of tags would be more appropriate here. Hence, for the job defined below, it would only trigger if a tag is pushed to the default branch and only the default branch. The tag pushed (<code>git push &lt;remote&gt; &lt;tag&gt;</code>) to the default branch on the remote would have the runner <strong>retag</strong> the Docker image that exists on Harbor with the tag that is being pushed. The relevant images to be retagged are originally tagged with the short commit hash obtained from the commit that was pushed to the default branch before this.</p> <div class="tabbed-set tabbed-alternate" data-tabs=7:1><input checked=checked id=__tabbed_7_1 name=__tabbed_7 type=radio><div class=tabbed-labels><label for=__tabbed_7_1><code>.gitlab-ci.yml</code></label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nn>...</span>
<span class=nt>build:retag-images</span><span class=p>:</span>
<span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gcr.io/go-containerregistry/crane:debug</span><span class=w> </span><span class=c1># google/cloud-sdk:debian_component_based for GCP</span>
<span class=w>    </span><span class=nt>entrypoint</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
<span class=w>  </span><span class=nt>variables</span><span class=p>:</span>
<span class=w>    </span><span class=nt>GOOGLE_APPLICATION_CREDENTIALS</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/gcp-sa.json</span><span class=w> </span><span class=c1># For GCP</span>
<span class=w>  </span><span class=nt>before_script</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;[[</span><span class=nv> </span><span class=s>-z</span><span class=nv> </span><span class=s>${HARBOR_ROBOT_CREDS_JSON}</span><span class=nv> </span><span class=s>]]</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>echo</span><span class=nv> </span><span class=s>&#39;HARBOR_ROBOT_CREDS_JSON</span><span class=nv> </span><span class=s>variable</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>not</span><span class=nv> </span><span class=s>set.&#39;</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>exit</span><span class=nv> </span><span class=s>1&quot;</span><span class=w> </span><span class=c1># For onprem</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;[[</span><span class=nv> </span><span class=s>-z</span><span class=nv> </span><span class=s>${GCP_SERVICE_ACCOUNT_KEY}</span><span class=nv> </span><span class=s>]]</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>echo</span><span class=nv> </span><span class=s>&#39;GCP_SERVICE_ACCOUNT_KEY</span><span class=nv> </span><span class=s>variable</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>not</span><span class=nv> </span><span class=s>set.&#39;</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>exit</span><span class=nv> </span><span class=s>1&quot;</span><span class=w> </span><span class=c1># For GCP</span>
<span class=w>  </span><span class=nt>script</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cat $HARBOR_ROBOT_CREDS_JSON &gt; /root/.docker/config.json</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">crane tag registry.aisingapore.net/project-path/cpu:${CI_COMMIT_SHORT_SHA} ${CI_COMMIT_TAG}</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">crane tag registry.aisingapore.net/project-path/gpu:${CI_COMMIT_SHORT_SHA} ${CI_COMMIT_TAG}</span>
<span class=w>    </span><span class=c1># For GCP:</span>
<span class=w>    </span><span class=c1>#- cat $GCP_SERVICE_ACCOUNT_KEY &gt; /gcp-sa.json</span>
<span class=w>    </span><span class=c1>#- gcloud container images add-tag &quot;gcr.io/project/project-path/cpu:${CI_COMMIT_SHORT_SHA}&quot; &quot;gcr.io/project/project-path/cpu:${CI_COMMIT_TAG}&quot;</span>
<span class=w>    </span><span class=c1>#- gcloud container images add-tag &quot;gcr.io/project/project-path/gpu:${CI_COMMIT_SHORT_SHA}&quot; &quot;gcr.io/project/project-path/gpu:${CI_COMMIT_TAG}&quot;</span>
<span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_COMMIT_TAG &amp;&amp; $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH</span>
<span class=w>  </span><span class=nt>needs</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build:cpu-image</span>
<span class=w>      </span><span class=nt>optional</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build:gpu-image</span>
<span class=w>      </span><span class=nt>optional</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nn>...</span>
</code></pre></div> </div> </div> </div> <details class=info> <summary>Reference Link(s)</summary> <ul> <li><a href=https://docs.github.com/en/get-started/quickstart/github-flow>GitHub Docs - GitHub Flow</a></li> <li><a href=https://docs.gitlab.com/ee/topics/gitlab_flow.html>GitLab Docs - GitLab Flow</a></li> <li><a href=https://github.com/google/go-containerregistry/blob/main/cmd/crane/README.md><code>go-containerregistry</code> GitHub - <code>crane</code></a></li> </ul> </details> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">&para;</a></h2> <p>The stages and jobs defined in this default pipeline is rudimentary at best as there is much more that could be done with GitLab CI. Some examples off the top:</p> <ul> <li>automatically generate reports for datasets that arrive in regular intervals</li> <li>submit model training jobs following triggers invoked by the same pipeline</li> <li>automate the deployment of the FastAPI servers to Kubernetes clusters</li> </ul> <p>There's much more that can be done but whatever has been shared thus far is hopefully enough for one to get started with CI/CD. </p> <p>Maintaining CI/CD pipelines requires extensive effort from developers. To reduce the effort required from developers, the MLOps Team has written a set of templates in which users can implement - plug and play with <a href=https://lighthouse.aisingapore.net/Platforms/MLOps&LLMOps/CICD-Components>CI/CD Components</a>.</p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../runai/08c-batch-inferencing/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Batch Inferencing"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Batch Inferencing </div> </div> </a> <a href=../10-documentation/ class="md-footer__link md-footer__link--next" aria-label="Next: Documentation"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Documentation </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023-2024 - AI Singapore </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://twitter.com/aisingapore target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg> </a> <a href=https://www.linkedin.com/company/aisingapore target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://www.instagram.com/ai_singapore/ target=_blank rel=noopener title=www.instagram.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141m0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7m146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8m76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8M398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.footer", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "toc.follow", "content.tabs.link", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.f1b6f286.min.js></script> <script src=../../termynal.js></script> </body> </html>