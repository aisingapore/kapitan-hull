<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content end-to-end template for ai projects&quot;&quot;><meta name=author content="AI Singapore"><link href=../05a-data-storage-versioning/ rel=prev><link href=../07a-deployment/ rel=next><link rel=icon href=../../favicon.svg><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.5"><title>Job Orchestration - AI Project Template</title><link rel=stylesheet href=../../assets/stylesheets/main.8608ea7d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../termynal.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=aisg data-md-color-primary=red data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#job-orchestration class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="AI Project Template" class="md-header__button md-logo" aria-label="AI Project Template" data-md-component=logo> <img src=../../aisg-logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AI Project Template </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Job Orchestration </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=aisg data-md-color-primary=red data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Overview </a> </li> <li class=md-tabs__item> <a href=../../setting-up/01-prerequisites/ class=md-tabs__link> Settting Up </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../03a-dev-wksp/ class=md-tabs__link> Running Locally </a> </li> <li class=md-tabs__item> <a href=../../docker/03b-dev-wksp/ class=md-tabs__link> Using Docker </a> </li> <li class=md-tabs__item> <a href=../../runai/03c-dev-wksp/ class=md-tabs__link> Using Run:ai </a> </li> <li class=md-tabs__item> <a href=../../appendix/09-cicd/ class=md-tabs__link> Sorting Out the Rest </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="AI Project Template" class="md-nav__button md-logo" aria-label="AI Project Template" data-md-component=logo> <img src=../../aisg-logo.png alt=logo> </a> AI Project Template </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Settting Up </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Settting Up </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../setting-up/01-prerequisites/ class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> </li> <li class=md-nav__item> <a href=../../setting-up/02-preface/ class=md-nav__link> <span class=md-ellipsis> Preface </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Running Locally </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Running Locally </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../03a-dev-wksp/ class=md-nav__link> <span class=md-ellipsis> Developer Workspace </span> </a> </li> <li class=md-nav__item> <a href=../04a-virtual-env/ class=md-nav__link> <span class=md-ellipsis> Virtual Environments </span> </a> </li> <li class=md-nav__item> <a href=../05a-data-storage-versioning/ class=md-nav__link> <span class=md-ellipsis> Data Storage & Versioning </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Job Orchestration </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Job Orchestration </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#pipeline-configuration class=md-nav__link> <span class=md-ellipsis> Pipeline Configuration </span> </a> </li> <li class=md-nav__item> <a href=#data-preparation-preprocessing class=md-nav__link> <span class=md-ellipsis> Data Preparation &amp; Preprocessing </span> </a> </li> <li class=md-nav__item> <a href=#model-training class=md-nav__link> <span class=md-ellipsis> Model Training </span> </a> <nav class=md-nav aria-label="Model Training"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hyperparameter-tuning class=md-nav__link> <span class=md-ellipsis> Hyperparameter Tuning </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../07a-deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment </span> </a> </li> <li class=md-nav__item> <a href=../08a-batch-inferencing/ class=md-nav__link> <span class=md-ellipsis> Batch Inferencing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Using Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Using Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docker/03b-dev-wksp/ class=md-nav__link> <span class=md-ellipsis> Developer Workspace </span> </a> </li> <li class=md-nav__item> <a href=../../docker/04b-virtual-env/ class=md-nav__link> <span class=md-ellipsis> Virtual Environments </span> </a> </li> <li class=md-nav__item> <a href=../../docker/05b-data-storage-versioning/ class=md-nav__link> <span class=md-ellipsis> Data Storage & Versioning </span> </a> </li> <li class=md-nav__item> <a href=../../docker/06b-job-orchestration/ class=md-nav__link> <span class=md-ellipsis> Job Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../../docker/07b-deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment </span> </a> </li> <li class=md-nav__item> <a href=../../docker/08b-batch-inferencing/ class=md-nav__link> <span class=md-ellipsis> Batch Inferencing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Using Run:ai </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Using Run:ai </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../runai/03c-dev-wksp/ class=md-nav__link> <span class=md-ellipsis> Developer Workspace </span> </a> </li> <li class=md-nav__item> <a href=../../runai/04c-virtual-env/ class=md-nav__link> <span class=md-ellipsis> Virtual Environments </span> </a> </li> <li class=md-nav__item> <a href=../../runai/05c-data-storage-versioning/ class=md-nav__link> <span class=md-ellipsis> Data Storage & Versioning </span> </a> </li> <li class=md-nav__item> <a href=../../runai/06c-job-orchestration/ class=md-nav__link> <span class=md-ellipsis> Job Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../../runai/07c-deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment </span> </a> </li> <li class=md-nav__item> <a href=../../runai/08c-batch-inferencing/ class=md-nav__link> <span class=md-ellipsis> Batch Inferencing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Sorting Out the Rest </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Sorting Out the Rest </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../appendix/09-cicd/ class=md-nav__link> <span class=md-ellipsis> CI/CD </span> </a> </li> <li class=md-nav__item> <a href=../../appendix/10-documentation/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#pipeline-configuration class=md-nav__link> <span class=md-ellipsis> Pipeline Configuration </span> </a> </li> <li class=md-nav__item> <a href=#data-preparation-preprocessing class=md-nav__link> <span class=md-ellipsis> Data Preparation &amp; Preprocessing </span> </a> </li> <li class=md-nav__item> <a href=#model-training class=md-nav__link> <span class=md-ellipsis> Model Training </span> </a> <nav class=md-nav aria-label="Model Training"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hyperparameter-tuning class=md-nav__link> <span class=md-ellipsis> Hyperparameter Tuning </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=job-orchestration>Job Orchestration<a class=headerlink href=#job-orchestration title="Permanent link">&para;</a></h1> <div class="admonition info"> <p class=admonition-title>Info</p> <p>The guide below is only meant for reference only and not meant to be followed verbatim. You may need to generate your own guide site if you require guidance specifically for your own project.</p> </div> <p>We can set up development workspaces to execute jobs and workflows locally.</p> <h2 id=pipeline-configuration>Pipeline Configuration<a class=headerlink href=#pipeline-configuration title="Permanent link">&para;</a></h2> <p>In this template, Hydra is the configuration framework of choice for the data preparation and model training pipelines (or any pipelines that doesn't belong to the model serving aspects).</p> <p>The configurations for logging, pipelines and hyperparameter tuning can be found under the <code>conf</code> folder. These YAML files are then referred to by Hydra or general utility functions (<code>src/project_package/general_utils.py</code>) for loading of parameters and configurations. The defined default values can be overridden through the CLI.</p> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>It is recommended that you have a basic understanding of <a href=https://hydra.cc/ >Hydra</a>'s concepts before you move on.</p> </div> <details class=info> <summary>Reference Link(s)</summary> <ul> <li><a href=https://hydra.cc/docs/advanced/override_grammar/basic/ >Hydra Docs - Basic Override Syntax</a></li> </ul> </details> <h2 id=data-preparation-preprocessing>Data Preparation &amp; Preprocessing<a class=headerlink href=#data-preparation-preprocessing title="Permanent link">&para;</a></h2> <p>To process the sample raw data, there are many ways to do so. One way is to run it locally. Ensure that you have activated your Conda environment before running the script. More information on this can be found <a href=../04a-virtual-env/ >here</a>. You can also update your configuration variables at <code>conf/process_data.yaml</code>, specifically this section:</p> <div class=highlight><pre><span></span><code><span class=nt>raw_data_dir_path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;./data/raw&quot;</span>
<span class=nt>processed_data_dir_path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;./data/processed&quot;</span>
<span class=nt>log_dir</span><span class=p>:</span><span class=w> </span><span class=s>&quot;./logs&quot;</span>
</code></pre></div> <p>After that, run the script:</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Linux/macOS</label><label for=__tabbed_1_2>Windows PowerShell</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=c1># Add no_cuda=False at the end to enable GPU use.</span>
<span class=c1># Make sure you have installed CUDA/RoCM before using.</span>
<span class=c1># Check that LD_LIBRARY_PATH has been set.</span>
<span class=c1># Also set HIP_VISIBLE_DEVICES=0 if RoCM is used.</span>
python<span class=w> </span>src/process_data.py
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=n>python</span> <span class=n>src</span><span class=p>\</span><span class=n>process_data</span><span class=p>.</span><span class=n>py</span>
</code></pre></div> </div> </div> </div> <h2 id=model-training>Model Training<a class=headerlink href=#model-training title="Permanent link">&para;</a></h2> <p>Now that we have processed the raw data, we can look into 'training' the model. The script relevant for this section is <code>src/train_model.py</code>. </p> <p>In this script, you can see it using some utility functions from <code>src/project_package/general_utils.py</code> as well, most notably the functions for utilising MLflow utilities for tracking experiments. Let's set up the tooling for experiment tracking before we start model experimentation.</p> <div class="admonition info"> <p class=admonition-title>Experiment Tracking and Logging</p> <p>In the module <code>src/project_package/general_utils.py</code>, the functions <code>mlflow_init</code> and <code>mlflow_log</code> are used to initialise MLflow experiments as well as log information and artifacts relevant for a run to an <code>mlruns</code> local folder.</p> <p>The <code>setup_logging</code> function now supports a <code>log_dir</code> parameter that allows you to specify a custom directory for log files. This is useful when you want to store logs in a specific location, such as a mounted volume in a container environment or a shared directory for team access.</p> <details class=info> <summary>Reference Link(s)</summary> <ul> <li><a href=https://www.mlflow.org/docs/latest/tracking.html#>MLflow Docs - Tracking</a></li> </ul> </details> </div> <p>To run the model training script locally, you should have your Conda environment activated from the data preparation stage, and update your configuration variables at <code>conf/train_model.yaml</code>, especially this section:</p> <div class=highlight><pre><span></span><code><span class=nt>setup_mlflow</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>mlflow_autolog</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=nt>mlflow_tracking_uri</span><span class=p>:</span><span class=w> </span><span class=s>&quot;./mlruns&quot;</span>
<span class=nt>mlflow_exp_name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;project_package_short&quot;</span>
<span class=nt>mlflow_run_name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;train-model&quot;</span>
<span class=nt>data_dir_path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;./data/processed&quot;</span>
<span class=nt>lr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.3</span>
<span class=nt>train_bs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">32</span>
<span class=nt>test_bs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class=nt>artifact_dir_path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;./models&quot;</span>
<span class=nt>epochs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class=nt>resume</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=nt>log_dir</span><span class=p>:</span><span class=w> </span><span class=s>&quot;./logs&quot;</span>
</code></pre></div> <p>After that, run the script:</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>Linux/macOS</label><label for=__tabbed_2_2>Windows PowerShell</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>python<span class=w> </span>src/train_model.py
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=n>python</span> <span class=n>src</span><span class=p>\</span><span class=n>train_model</span><span class=p>.</span><span class=n>py</span>
</code></pre></div> </div> </div> </div> <p>This will generate the MLFlow logs and artifacts locally, of which you can parse it with the MLFlow UI with:</p> <div class=highlight><pre><span></span><code>conda<span class=w> </span>create<span class=w> </span>-n<span class=w> </span>mlflow-test<span class=w> </span>mlflow
conda<span class=w> </span>activate<span class=w> </span>mlflow-test
mlflow<span class=w> </span>server
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>You may not use the <code>project</code> Conda environment</p> <p>You would most likely not able to use the <code>project</code> Conda environment to run <code>mlflow server</code> as the package installed within that environment is <code>mlflow-skinny</code>, not the fully-featured <code>mlflow</code> that contains the server components.</p> </div> <p>and connect to <a href=http://localhost:5000>http://localhost:5000</a>.</p> <p><img alt="MLflow Tracking Server - Inspecting Runs" src=https://storage.googleapis.com/aisg-mlops-pub-data/images/mlflow-tracking-server-inspect.gif></p> <div class="admonition info"> <p class=admonition-title>Resuming/adding new epochs</p> <p>The training script supports resuming training from a previous checkpoint by setting the <code>resume</code> parameter to <code>true</code> in the configuration file. When this parameter is enabled, the script will:</p> <ol> <li>Check for the latest step logged by MLFlow</li> <li>Offset the epoch step with the latest step from MLFlow</li> <li>Continue training from the last saved epoch</li> <li>Log the continued training as part of the same MLflow run</li> </ol> <p>This is particularly useful when:</p> <ul> <li>You need to extend training for additional epochs after evaluating initial results</li> <li>Training was interrupted and needs to be continued</li> <li>You want to implement a progressive training strategy with changing parameters</li> </ul> <p>To use this feature, simply set <code>resume: true</code> in your <code>conf/train_model.yaml</code> file or append <code>resume=true</code> during runtime as an override and run the training script as normal.</p> </div> <h3 id=hyperparameter-tuning>Hyperparameter Tuning<a class=headerlink href=#hyperparameter-tuning title="Permanent link">&para;</a></h3> <p>For many ML problems, we would be bothered with finding the optimal parameters to train our models with. While we are able to override the parameters for our model training workflows, imagine having to sweep through a distribution of values. For example, if you were to seek for the optimal learning rate within a log space, we would have to execute <code>runai submit</code> a myriad of times manually, just to provide the training script with a different learning rate value each time. It is reasonable that one seeks for ways to automate this workflow.</p> <p><a href=https://optuna.readthedocs.io/en/stable/ >Optuna</a> is an optimisation framework designed for ML use-cases. Its features includes:</p> <ul> <li>ease of modularity,</li> <li>optimisation algorithms for searching the best set of parameters,</li> <li>and <a href=https://optuna.readthedocs.io/en/stable/tutorial/10_key_features/004_distributed.html>parallelisation</a> capabilities for faster sweeps.</li> </ul> <p>In addition, Hydra has a plugin for utilising Optuna which further translates to ease of configuration. To use Hydra's plugin for Optuna, we have to provide further overrides within the YAML config, and this is observed in <code>conf/train_model.yaml</code>:</p> <div class=highlight><pre><span></span><code><span class=nt>defaults</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>override hydra/sweeper</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">optuna</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>override hydra/sweeper/sampler</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tpe</span>

<span class=nt>hydra</span><span class=p>:</span>
<span class=w>  </span><span class=nt>sweeper</span><span class=p>:</span>
<span class=w>    </span><span class=nt>sampler</span><span class=p>:</span>
<span class=w>      </span><span class=nt>seed</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">55</span>
<span class=w>    </span><span class=nt>direction</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;minimize&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;maximize&quot;</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>study_name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;base-template&quot;</span>
<span class=w>    </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class=w>    </span><span class=nt>n_trials</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class=w>    </span><span class=nt>n_jobs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class=w>    </span><span class=nt>params</span><span class=p>:</span>
<span class=w>      </span><span class=nt>lr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">range(0.9,1.7,step=0.1)</span>
<span class=w>      </span><span class=nt>train_bs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">choice(32,48,64)</span>
</code></pre></div> <p>These fields are used by the Optuna Sweeper plugin to configure the Optuna study.</p> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>The fields defined are terminologies used by Optuna. Therefore, it is recommended that you understand the basics of the tool. <a href="https://www.youtube.com/watch?v=P6NwZVl8ttc">This overview video</a> covers well on the concepts brought upon by Optuna.</p> <p>Here are the definitions for some of the fields:</p> <ul> <li><code>params</code> is used to specify the parameters to be tuned, and the values to be searched through</li> <li><code>n_trials</code> specifies the number of trials to be executed</li> <li><code>n_jobs</code> specifies the number of trials to be executed in parallel</li> </ul> </div> <p>As to how the training script would work towards training a model with the best set of parameters, there are two important lines from two different files that we have to pay attention to.</p> <p><code>src/train_model.py</code> <div class=highlight><pre><span></span><code><span class=o>...</span>
    <span class=k>return</span> <span class=n>curr_test_loss</span><span class=p>,</span> <span class=n>curr_test_accuracy</span>
<span class=o>...</span>
</code></pre></div></p> <p><code>conf/train_model.yaml</code> <div class=highlight><pre><span></span><code><span class=nn>...</span>
<span class=w>    </span><span class=nt>direction</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;minimize&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;maximize&quot;</span><span class="p p-Indicator">]</span>
<span class=nn>...</span>
</code></pre></div></p> <p>In the training script the returned variables are to contain values that we seek to optimise for. In this case, we seek to minimise the loss and maximise the accuracy. The <code>hydra.sweeper.direction</code> field in the YAML config is used to specify the direction that those variables are to optimise towards, defined in a positional manner within a list.</p> <p>An additional thing to take note of is that for each trial where a different set of parameters are concerned, a new MLflow run has to be initialised. However, we need to somehow link all these different runs together so that we can compare all the runs within a single Optuna study (set of trials). How we do this is that we provide each trial with the same tag to be logged to MLflow (<code>hptuning_tag</code>) which would essentially be the date epoch value of the moment you run the script. This tag is defined using the environment value <code>MLFLOW_HPTUNING_TAG</code>.</p> <div class="tabbed-set tabbed-alternate" data-tabs=3:2><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><input id=__tabbed_3_2 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>Linux/macOS</label><label for=__tabbed_3_2>Windows PowerShell</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>python<span class=w> </span>src/train_model.py<span class=w> </span>--multirun
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=n>python</span> <span class=n>src</span><span class=p>\</span><span class=n>train_model</span><span class=p>.</span><span class=n>py</span> <span class=p>-</span><span class=n>-multirun</span>
</code></pre></div> </div> </div> </div> <p><img alt="MLflow Tracking Server - Hyperparameter Tuning Runs" src=../../common/assets/screenshots/mlflow-tracking-hptuning-runs.png></p> <details class=info> <summary>Reference Link(s)</summary> <ul> <li><a href=https://hydra.cc/docs/plugins/optuna_sweeper/ >Hydra Docs - Optuna Sweeper Plugin</a></li> <li><a href=https://www.mlflow.org/docs/latest/search-syntax.html>MLflow Docs - Search Syntax</a></li> </ul> </details> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../05a-data-storage-versioning/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Data Storage & Versioning"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Data Storage & Versioning </div> </div> </a> <a href=../07a-deployment/ class="md-footer__link md-footer__link--next" aria-label="Next: Deployment"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Deployment </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023-2024 - AI Singapore </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://twitter.com/aisingapore target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg> </a> <a href=https://www.linkedin.com/company/aisingapore target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://www.instagram.com/ai_singapore/ target=_blank rel=noopener title=www.instagram.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141m0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7m146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8m76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8M398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.footer", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "toc.follow", "content.tabs.link", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.f1b6f286.min.js></script> <script src=../../termynal.js></script> </body> </html>